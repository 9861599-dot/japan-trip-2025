<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chiikawa Trip</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#fff1f2">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1908/1908344.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'M PLUS Rounded 1c', 'Kosugi Maru', -apple-system, sans-serif;
            background-color: #fff1f2;
            background-image: radial-gradient(#fecdd3 1px, transparent 1px);
            background-size: 20px 20px;
            color: #475569;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 90px;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .app-card {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 1.5rem;
            box-shadow: 0 4px 15px rgba(251, 113, 133, 0.15);
            border: 2px solid #fff;
            overflow: hidden;
            transition: transform 0.2s;
            position: relative;
        }
        .app-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 6px;
            background: linear-gradient(to right, #f9a8d4, #f472b6);
        }

        .tag-base { @apply px-2.5 py-1 rounded-full text-xs font-bold mr-1.5 mb-1 inline-block border-2 shadow-sm; }
        .tag-food { @apply bg-orange-100 text-orange-600 border-orange-200; }
        .tag-buy { @apply bg-rose-100 text-rose-600 border-rose-200; }
        .tag-transport { @apply bg-blue-100 text-blue-600 border-blue-200; }
        .tag-highlight { @apply bg-yellow-100 text-yellow-700 border-yellow-200; }
        .tag-code { @apply bg-purple-100 text-purple-600 border-purple-200 font-mono tracking-wider; }
        .tag-cost { @apply bg-emerald-100 text-emerald-600 border-emerald-200; }

        .btn-cute {
            @apply active:scale-95 transition-transform rounded-2xl font-bold shadow-md border-b-4 active:border-b-0 active:translate-y-1;
        }

        /* Loading ÂãïÁï´ */
        .chiikawa-bounce {
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- ÈÄôË£°ÊîπÁî® module Ê®°Âºè‰æÜÊîØÊè¥ Firebase import -->
    <script type="text/babel" data-type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc, getDoc, collection } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const { useState, useEffect, useRef } = React;

        // =========================================
        // 1. Ë®≠ÂÆö Firebase Config (ÂåÖÂê´Ëá™ÂãïÂÅµÊ∏¨)
        // =========================================
        const getFirebaseConfig = () => {
            // ÂÑ™ÂÖàÂòóË©¶‰ΩøÁî®Áí∞Â¢ÉËÆäÊï∏ (ËÆì‰Ω†Âú®È†êË¶ΩË¶ñÁ™ó‰∏çÊúÉÂ†±ÈåØ)
            try {
                if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                    return JSON.parse(__firebase_config);
                }
            } catch (e) {
                console.log("Not in preview mode or config invalid");
            }
            
            // üî¥ Â¶ÇÊûú‰Ω†Ë¶ÅÈÉ®ÁΩ≤Âà∞ NetlifyÔºåË´ãÂú®ÈÄôË£°Â°´ÂÖ•‰Ω†ÁöÑ Firebase Ë®≠ÂÆö üî¥
            return {
                    apiKey: "AIzaSyCpOfvR92qEkDHDZio8jZ4VR-tru2MScSQ",
                    authDomain: "japan-trip-2025-5f3a3.firebaseapp.com",
                    projectId: "japan-trip-2025-5f3a3",
                    storageBucket: "japan-trip-2025-5f3a3.firebasestorage.app",
                    messagingSenderId: "828851638958",
                    appId: "1:828851638958:web:59bad47902fe08671b933f"
            };
        };

        const firebaseConfig = getFirebaseConfig();
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // =========================================
        // ‰øÆÊ≠£Ë∑ØÂæë: ÈÅµÂÆà Public Data Ë¶èÂâá‰ª•Ëß£Ê±∫Ê¨äÈôêÈåØË™§
        // Ë∑ØÂæëÁµêÊßã: artifacts/{appId}/public/data/{collectionName}/{documentId}
        // =========================================
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        // ‰ΩøÁî®Èô£Âàó‰æÜÂÆöÁæ©Ë∑ØÂæëÔºåÊñπ‰æø doc() ÂáΩÊï∏‰ΩøÁî®
        // ÊàëÂÄëÂ∞áË≥áÊñôÂ≠òÊîæÂú® 'trips' ÈõÜÂêà‰∏≠ÁöÑ 'shared_japan_2025' Êñá‰ª∂
        const TRIP_DOC_PATH = ['artifacts', appId, 'public', 'data', 'trips', 'shared_japan_2025'];

        // =========================================
        // ÂéüÂßãË≥áÊñôÁµêÊßã (È†êË®≠ÂÄº)
        // =========================================
        const defaultItinerary = [
            {
                id: 'day1', date: '5/10 (ÂÖ≠)', title: 'Ê°ÉÂúí ‚Üí Â∞èÊùæ ‚Üí ÈáëÊæ§',
                location: 'ÈáëÊæ§',
                weather: { icon: 'fa-sun', text: 'Êô¥ÊôÇÂ§öÈõ≤ 18¬∞C', alert: false },
                events: [
                    { id: 'e1-1', type: 'transport', time: '10:25', title: 'IT 252 Ê°ÉÂúíËµ∑È£õ', desc: 'ËôéËà™ IT 252ÔºåÂâçÂæÄÂ∞èÊùæÊ©üÂ†¥ (KMQ)', location: 'Ê°ÉÂúíÂúãÈöõÊ©üÂ†¥' },
                    { id: 'e1-2', type: 'transport', time: '14:00', title: 'ÊäµÈÅîÂ∞èÊùæÊ©üÂ†¥', desc: 'Ëæ¶ÁêÜÂÖ•Â¢ÉÔºåÈ†òÂèñË°åÊùé„ÄÇ', location: 'Â∞èÊùæÊ©üÂ†¥' },
                    { id: 'e1-3', type: 'transport', time: '15:00', title: 'ÁßüËªä / Â∑¥Â£´', desc: 'ÂâçÂæÄÈáëÊæ§Â∏ÇÂçÄ (ËªäÁ®ãÁ¥Ñ 40-50 ÂàÜÈêò)', location: 'Â∞èÊùæÊ©üÂ†¥ÁßüËªäÊ´ÉÂè∞' },
                    { id: 'e1-4', type: 'accommodation', time: '16:00', title: 'È£ØÂ∫ó Check-in', desc: 'ÂÖ•‰ΩèÈáëÊæ§Â∏ÇÂçÄÈ£ØÂ∫óÔºåÊîæÁΩÆË°åÊùé', location: 'ÈáëÊæ§Â∏Ç' },
                    { id: 'e1-5', type: 'sight', time: '17:00', title: 'ÈáëÊæ§Á´ô„ÄåÈºìÈñÄ„Äç', desc: 'ÈáëÊæ§Âú∞Ê®ôÔºå‰∏ñÁïåÊúÄÁæéËªäÁ´ô‰πã‰∏ÄÔºåÂ§úÊôØÂøÖÊãç„ÄÇ', location: 'ÈáëÊæ§ËªäÁ´ô ÈºìÈñÄ' },
                    { id: 'e1-6', type: 'food', time: '18:00', title: 'ÈáëÊæ§ÊôöÈ§ê', desc: 'ËªäÁ´ôÂë®ÈÇäÁæéÈ£üÂ∑°Á¶Æ', location: 'ÈáëÊæ§ÁôæÁï™Ë°ó', highlights: [{type: 'must-eat', text: 'Â£ΩÂè∏ „Åæ„ÅÑ„ÇÇ„Çì'}, {type: 'must-eat', text: 'ÈáëÊæ§ÂíñÂì©'}] },
                ]
            },
            {
                id: 'day2', date: '5/11 (Êó•)', title: 'ÈáëÊæ§Âè§ÈÉΩÂ∑°Á¶Æ',
                location: 'ÈáëÊæ§',
                weather: { icon: 'fa-cloud-sun', text: 'Â§öÈõ≤ 20¬∞C', alert: false },
                events: [
                    { id: 'e2-1', type: 'sight', time: '09:00', title: 'ÂÖºÂÖ≠Âúí', desc: 'Êó•Êú¨‰∏âÂ§ßÂêçÂúí‰πã‰∏ÄÔºåÊó•ÂºèÂ∫≠ÂúíÈÄ†ÊôØÂ∑îÂ≥∞„ÄÇ', location: 'ÂÖºÂÖ≠Âúí', highlights: [{type: 'highlight', text: 'ÂæΩËª´ÁáàÁ±†'}] },
                    { id: 'e2-2', type: 'sight', time: '10:30', title: 'ÈáëÊæ§ÂüéÂÖ¨Âúí', desc: 'Â∞±Âú®ÂÖºÂÖ≠ÂúíÂ∞çÈù¢ÔºåÂèÉËßÄ‰∫îÂçÅÈñìÈï∑Â±ã„ÄÇ', location: 'ÈáëÊæ§ÂüéÂÖ¨Âúí' },
                    { id: 'e2-3', type: 'sight', time: '12:00', title: '21 ‰∏ñÁ¥ÄÁæéË°ìÈ§®', desc: 'ËëóÂêçÁöÑ„ÄåÊ≥≥Ê±†„ÄçË£ùÁΩÆËóùË°ì', location: 'ÈáëÊæ§21‰∏ñÁ¥ÄÁæéË°ìÈ§®' },
                    { id: 'e2-4', type: 'food', time: '13:30', title: 'ÂçàÈ§ê', desc: 'ËøëÊ±üÁî∫Â∏ÇÂ†¥Êµ∑ÈÆÆÊàñÂë®ÈÇäËå∂Â±ã', location: 'ËøëÊ±üÁî∫Â∏ÇÂ†¥', highlights: [{type: 'must-eat', text: 'Êµ∑ÈÆÆ‰∏º'}] },
                    { id: 'e2-5', type: 'sight', time: '15:00', title: 'Êù±Ëå∂Â±ãË°ó', desc: '‰øùÁïôÊ±üÊà∂ÊôÇ‰ª£È¢®ÊÉÖÔºåÈáëÁÆîÂÜ∞Ê∑áÊ∑ãÁôºÊ∫êÂú∞„ÄÇ', location: 'Êù±Ëå∂Â±ãË°ó', highlights: [{type: 'must-eat', text: 'ÈáëÁÆîÂÜ∞Ê∑áÊ∑ã'}] },
                    { id: 'e2-6', type: 'food', time: '18:30', title: 'ÊôöÈ§êÔºöÈáëÊæ§ÈóúÊù±ÁÖÆ', desc: 'ÈáëÊæ§ÁâπËâ≤ÈóúÊù±ÁÖÆ (Ëµ§ÁéâÊú¨Â∫ó / ÈªëÁôæÂêà)', location: 'Ëµ§ÁéâÊú¨Â∫ó', highlights: [{type: 'must-eat', text: 'ËªäÈ∫©„ÄÅËµ§Âç∑'}] }
                ]
            },
            {
                id: 'day3', date: '5/12 (‰∏Ä)', title: 'ÂêàÊéåÊùë ‚Üí È´òÂ±±',
                location: 'È´òÂ±±',
                weather: { icon: 'fa-cloud', text: 'Èô∞Â§© 15¬∞C', alert: false },
                events: [
                    { id: 'e3-1', type: 'transport', time: '09:00', title: 'ÂâçÂæÄÁôΩÂ∑ùÈÑâ', desc: 'Ëá™ÈßïÊàñÂ∑¥Â£´ÔºåËªäÁ®ãÁ¥Ñ 1Â∞èÊôÇ 15ÂàÜ„ÄÇ', location: 'ÁôΩÂ∑ùÈÑâÂêàÊéåÊùë' },
                    { id: 'e3-2', type: 'sight', time: '10:30', title: 'ÁôΩÂ∑ùÈÑâÂêàÊéåÊùë', desc: '‰∏ñÁïåÈÅ∫Áî¢Á´•Ë©±ÊùëËêΩ„ÄÇ', location: 'ÁôΩÂ∑ùÈÑâ', highlights: [{type: 'highlight', text: 'ÂüéÂ±±Â±ïÊúõÂè∞'}, {type: 'must-eat', text: '‰∫îÂπ≥È§Ö'}] },
                    { id: 'e3-3', type: 'food', time: '12:30', title: 'ÂçàÈ§êÔºöÊú¥ËëâÂë≥ÂôåÁáí', desc: 'È£õÈ©íÂú∞ÂçÄÁâπËâ≤ÊñôÁêÜ„ÄÇ', location: 'ÁôΩÂ∑ùÈÑâ' },
                    { id: 'e3-4', type: 'transport', time: '14:00', title: 'ÂâçÂæÄÈ´òÂ±±', desc: 'ËªäÁ®ãÁ¥Ñ 50 ÂàÜÈêò„ÄÇ', location: 'È´òÂ±±Â∏Ç' },
                    { id: 'e3-5', type: 'sight', time: '15:00', title: 'È´òÂ±±ËÄÅË°ó', desc: '„ÄåÈ£õÈ©íÁöÑÂ∞è‰∫¨ÈÉΩ„ÄçÔºå‰øùÁïôÂè§ËÄÅË°óÊôØ„ÄÇ', location: 'È´òÂ±±‰∏âÁî∫Á≠ã', highlights: [{type: 'must-eat', text: 'È£õÈ©íÁâõÊè°Â£ΩÂè∏'}, {type: 'must-eat', text: 'È´òÂ±±Â∏É‰∏Å'}] },
                    { id: 'e3-6', type: 'accommodation', time: '17:00', title: 'È´òÂ±±‰ΩèÂÆø Check-in', desc: 'Êé®Ëñ¶ÂÖ•‰ΩèÈ´òÂ±±Á´ôÂë®ÈÇäÔºåÊñπ‰æøÁßªÂãï„ÄÇ', location: 'È´òÂ±±Á´ô' },
                    { id: 'e3-7', type: 'food', time: '18:30', title: 'ÊôöÈ§êÔºöÈ£õÈ©íÁâõÁáíËÇâ', desc: 'Êó•Êú¨È†ÇÁ¥öÂíåÁâõÈ´îÈ©ó„ÄÇ', location: 'È´òÂ±±Â∏Ç', highlights: [{type: 'must-eat', text: '‰∏∏Êòé / Âë≥ËóèÂ§©Âúã'}] }
                ]
            },
            {
                id: 'day4', date: '5/13 (‰∫å)', title: 'È´òÂ±±ÊúùÂ∏Ç ‚Üí ÂØåÂ±±',
                location: 'ÂØåÂ±±',
                weather: { icon: 'fa-sun', text: 'Êô¥Â§© 22¬∞C', alert: false },
                events: [
                    { id: 'e4-1', type: 'sight', time: '08:00', title: 'ÂÆÆÂ∑ùÊúùÂ∏Ç', desc: 'Êó•Êú¨‰∏âÂ§ßÊúùÂ∏Ç‰πã‰∏ÄÔºåÊ≤øËëóÊ≤≥ÈÇäÁöÑÁÜ±È¨ßÂ∏ÇÈõÜ„ÄÇ', location: 'ÂÆÆÂ∑ùÊúùÂ∏Ç' },
                    { id: 'e4-2', type: 'sight', time: '10:00', title: 'È´òÂ±±Èô£Â±ã', desc: 'Êó•Êú¨ÂîØ‰∏ÄÁèæÂ≠òÁöÑ‰ª£ÂÆòÊâÄ„ÄÇ', location: 'È´òÂ±±Èô£Â±ã' },
                    { id: 'e4-3', type: 'transport', time: '13:00', title: 'ÂâçÂæÄÂØåÂ±±', desc: 'ËªäÁ®ãÁ¥Ñ 1.5 Â∞èÊôÇ„ÄÇ', location: 'ÂØåÂ±±Â∏Ç' },
                    { id: 'e4-4', type: 'sight', time: '15:00', title: 'ÂØåÂ±±Â∏ÇÁ´ãÁéªÁíÉÁæéË°ìÈ§®', desc: 'Âª∫ÁØâÂ§ßÂ∏´ÈöàÁ†îÂêæË®≠Ë®àÔºåÂÖâÂΩ±Ê•µÁæé„ÄÇ', location: 'ÂØåÂ±±Â∏ÇÁéªÁíÉÁæéË°ìÈ§®' },
                    { id: 'e4-5', type: 'sight', time: '16:30', title: 'ÂØåÂ≤©ÈÅãÊ≤≥Áí∞Ê∞¥ÂÖ¨Âúí', desc: 'ÊìÅÊúâ„Äå‰∏ñÁïåÊúÄÁæéÊòüÂ∑¥ÂÖã„ÄçÔºåÈÅ©ÂêàÊï£Ê≠•ÁúãÂ§ïÈôΩ„ÄÇ', location: 'ÂØåÂ≤©ÈÅãÊ≤≥Áí∞Ê∞¥ÂÖ¨Âúí' },
                    { id: 'e4-6', type: 'food', time: '18:00', title: 'ÊôöÈ§êÔºöÁôΩËù¶ÊñôÁêÜ', desc: 'ÂØåÂ±±ÁÅ£ÁöÑÂØ∂Áü≥„ÄåÁôΩËù¶„Äç„ÄÇ', location: 'ÂØåÂ±±ËªäÁ´ô', highlights: [{type: 'must-eat', text: 'ÁôΩËù¶Â§©‰∏º'}] }
                ]
            },
            {
                id: 'day5', date: '5/14 (‰∏â)', title: 'Á©øË∂äÁ´ãÂ±±ÈªëÈÉ®',
                location: 'Èï∑Èáé',
                weather: { icon: 'fa-snowflake', text: 'Â±±ÂçÄ‰ΩéÊ∫´ 5¬∞C', alert: true },
                events: [
                    { id: 'e5-1', type: 'transport', time: '07:00', title: 'ÂâçÂæÄÁ´ãÂ±±Á´ô', desc: 'ËªäËºõÈúÄË´ã‰ª£ÈßïÈÅãÈÄÅÂà∞ÊâáÊæ§Ôºå‰∫∫Áõ¥Êé•Á©øË∂ä„ÄÇ', location: 'Á´ãÂ±±Á´ô' },
                    { id: 'e5-2', type: 'sight', time: '09:00', title: 'ÁæéÂ•≥Âπ≥ / ÂÆ§Â†Ç', desc: 'ËΩâ‰πòÈ´òÂéüÂ∑¥Â£´„ÄÇÂÆ§Â†ÇÂπ≥ÁúãÈõ™Â£Å (Ë¶ñÂ≠£ÁØÄ) ÊàñÂæ°Â∫´Ë£èÊ±†„ÄÇ', location: 'ÂÆ§Â†Ç' },
                    { id: 'e5-3', type: 'transport', time: '11:00', title: 'Â§ßËßÄÂ≥∞ / ÈªëÈÉ®Âπ≥', desc: 'Êê≠‰πòÁ©∫‰∏≠Á∫úËªäÔºåÁÑ°ÊîØÊü±Ë®≠Ë®àË¶ñÈáéÁÑ°Ê≠ªËßí„ÄÇ', location: 'Â§ßËßÄÂ≥∞' },
                    { id: 'e5-4', type: 'sight', time: '13:00', title: 'ÈªëÈÉ®Ê∞¥Â∫´', desc: 'Êó•Êú¨ÊúÄÂ§ßÊã±ÂΩ¢Ê∞¥Â∫´ÔºåÊ≠•Ë°åÁ©øË∂äÂ£©È†Ç„ÄÇ', location: 'ÈªëÈÉ®Ê∞¥Â∫´' },
                    { id: 'e5-5', type: 'transport', time: '15:00', title: 'ÊäµÈÅîÊâáÊæ§ / ÂèñËªä', desc: 'Á©øË∂äÂÆåÊàêÔºåÊäµÈÅîÈï∑ÈáéÂÅ¥„ÄÇ', location: 'ÊâáÊæ§Á´ô' },
                    { id: 'e5-6', type: 'transport', time: '16:30', title: 'ÂâçÂæÄÈï∑Èáé‰ΩèÂÆø', desc: 'ËªäÁ®ãÁ¥Ñ 1.5 Â∞èÊôÇ„ÄÇ', location: 'Èï∑ÈáéÂ∏Ç' },
                    { id: 'e5-7', type: 'food', time: '18:30', title: 'ÊôöÈ§êÔºö‰ø°Â∑ûËïéÈ∫•È∫µ', desc: 'Èï∑ÈáéÂêçÁâ©„ÄÇ', location: 'Èï∑ÈáéËªäÁ´ô', highlights: [{type: 'must-eat', text: 'ËïéÈ∫•È∫µ'}] }
                ]
            },
            {
                id: 'day6', date: '5/15 (Âõõ)', title: 'Èï∑Èáé ‚Üí Ëºï‰∫ïÊæ§ ‚Üí Êù±‰∫¨',
                location: 'Êù±‰∫¨',
                weather: { icon: 'fa-sun', text: 'Êô¥Â§© 23¬∞C', alert: false },
                events: [
                    { id: 'e6-1', type: 'sight', time: '09:00', title: 'ÂñÑÂÖâÂØ∫', desc: 'Êó•Êú¨ËëóÂêçÂè§ÂâéÔºåÈï∑ÈáéÁöÑÁ≤æÁ•û‰∏≠ÂøÉ„ÄÇ', location: 'ÂñÑÂÖâÂØ∫' },
                    { id: 'e6-2', type: 'transport', time: '11:00', title: 'ÂâçÂæÄËºï‰∫ïÊæ§', desc: 'ÈÅøÊöëÂãùÂú∞„ÄÇ', location: 'Ëºï‰∫ïÊæ§' },
                    { id: 'e6-3', type: 'sight', time: '12:00', title: 'Ëºï‰∫ïÊæ§ Outlet', desc: 'Ê£ÆÊûó‰∏≠ÁöÑÂ§ßÂûãË≥ºÁâ©‰∏≠ÂøÉÔºåÂçàÈ§êÂú®Ê≠§Ëß£Ê±∫„ÄÇ', location: 'Ëºï‰∫ïÊæ§ÁéãÂ≠êË≥ºÁâ©Âª£Â†¥', highlights: [{type: 'must-buy', text: 'ÈÅãÂãïÂìÅÁâå/Á≤æÂìÅ'}] },
                    { id: 'e6-4', type: 'sight', time: '15:00', title: 'ËàäËºï‰∫ïÊæ§ÈäÄÂ∫ßÈÄö', desc: 'Ë≥ºË≤∑ÊûúÈÜ¨„ÄÅÈ∫µÂåÖ‰º¥ÊâãÁ¶Æ„ÄÇ', location: 'ËàäËºï‰∫ïÊæ§ÈäÄÂ∫ßÈÄö', highlights: [{type: 'must-buy', text: 'SAWAYA ÊûúÈÜ¨'}] },
                    { id: 'e6-5', type: 'transport', time: '17:00', title: 'ÂâçÂæÄÊù±‰∫¨', desc: 'ÈÇÑËªäÔºåËΩâÁÇ∫Â§ßÁúæÈÅãËº∏Ê®°Âºè„ÄÇ', location: '‰∏äÈáéÁ´ô' },
                    { id: 'e6-6', type: 'accommodation', time: '19:00', title: 'Êù±‰∫¨‰ΩèÂÆø Check-in', desc: 'Âª∫Ë≠∞‰Ωè‰∏äÈáéÊàñÊ∑∫ËçâÔºåÂæÄËøîÊ©üÂ†¥Êñπ‰æø„ÄÇ', location: '‰∏äÈáé' }
                ]
            },
            {
                id: 'day7', date: '5/16 (‰∫î)', title: 'Êù±‰∫¨Ëá™Áî±Ë°å',
                location: 'Êù±‰∫¨',
                weather: { icon: 'fa-cloud-sun', text: 'Êô¥ÊôÇÂ§öÈõ≤ 24¬∞C', alert: false },
                events: [
                    { id: 'e7-1', type: 'sight', time: '10:00', title: 'Êù±‰∫¨Â∏ÇÂçÄËá™Áî±Ê¥ªÂãï', desc: '‰æùËààË∂£ÈÅ∏ÊìáË∑ØÁ∑ö„ÄÇ', location: 'Êù±‰∫¨' },
                    { id: 'e7-2', type: 'activity', time: 'Option', title: 'ÊæÄË∞∑ / Shibuya Sky', desc: 'ÊΩÆÊµÅÊôÇÂ∞ö„ÄÅÂ±ïÊúõÂè∞„ÄÇ', location: 'ÊæÄË∞∑ SCRAMBLE SQUARE', highlights: [{type: 'highlight', text: 'Shibuya Sky'}] },
                    { id: 'e7-3', type: 'activity', time: 'Option', title: 'Ê∑∫Ëçâ / Êô¥Á©∫Â°î', desc: '‰∏ãÁî∫È¢®ÊÉÖËàáÁèæ‰ª£Âú∞Ê®ô„ÄÇ', location: 'Èõ∑ÈñÄ', highlights: [{type: 'must-eat', text: 'Ê∑∫ËçâÁÇ∏ËÇâÈ§Ö'}] },
                    { id: 'e7-4', type: 'food', time: '18:00', title: 'ÊôöÈ§êÔºöË±™ËèØÂ§ßÈ§ê', desc: 'ÁáíËÇâ„ÄÅÂ£ΩÂñúÁáíÊàñÂ±ÖÈÖíÂ±ãÔºåÊÖ∂Á•ùÊóÖÁ®ãÊúÄÂæå‰∏ÄÊôö„ÄÇ', location: 'Êù±‰∫¨' }
                ]
            },
            {
                id: 'day8', date: '5/17 (ÂÖ≠)', title: 'Êù±‰∫¨ ‚Üí Ê°ÉÂúí',
                location: 'Ê°ÉÂúí',
                weather: { icon: 'fa-plane', text: 'ËøîÂÆ∂', alert: false },
                events: [
                    { id: 'e8-1', type: 'activity', time: '09:00', title: 'ÊúÄÂæåÊé°Ë≤∑', desc: '‰∏äÈáé‰∫åÊú®‰πãËèìÂ≠êÈõ∂È£üÊé°Ë≤∑„ÄÇ', location: '‰∫åÊú®‰πãËèìÂ≠ê' },
                    { id: 'e8-2', type: 'transport', time: '11:00', title: 'ÂâçÂæÄÊàêÁî∞Ê©üÂ†¥', desc: 'Êê≠‰πò Skyliner (Á¥Ñ 41 ÂàÜÈêò)„ÄÇ', location: '‰∫¨Êàê‰∏äÈáéÁ´ô' },
                    { id: 'e8-3', type: 'transport', time: '12:00', title: 'Ê©üÂ†¥Â†±Âà∞', desc: 'ÊàêÁî∞Ê©üÂ†¥ T2ÔºåÈÄõÂÖçÁ®ÖÂ∫ó„ÄÇ', location: 'ÊàêÁî∞Ê©üÂ†¥Á¨¨‰∫åËà™Âªà' },
                    { id: 'e8-4', type: 'transport', time: '13:30', title: 'IT 252 Ëµ∑È£õ', desc: 'ËôéËà™ IT 252 (È†êË®à)', location: 'ÊàêÁî∞Ê©üÂ†¥' },
                    { id: 'e8-5', type: 'transport', time: '16:40', title: 'Âπ≥ÂÆâËøîÂÆ∂', desc: 'ÊäµÈÅîÈ´òÈõÑ(ÊàñÊ°ÉÂúí)', location: 'È´òÈõÑÂ∞èÊ∏ØÊ©üÂ†¥' }
                ]
            }
        ];

        // =========================================
        // Components
        // =========================================

        const NavigateButton = ({ location }) => {
            if (!location) return null;
            const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`;
            return (
                <a href={mapsUrl} target="_blank" rel="noopener noreferrer" 
                   className="inline-flex items-center gap-1.5 bg-sky-200 text-sky-700 text-xs px-3 py-1.5 rounded-2xl font-bold shadow-sm hover:bg-sky-300 active:scale-95 transition-all mt-2 no-underline border border-sky-300">
                    <i className="fa-solid fa-location-arrow text-[0.7rem]"></i>
                    <span>Go!</span>
                </a>
            );
        };

        const Tag = ({ type, text }) => {
            let colorClass = "tag-base bg-slate-100 text-slate-600 border-slate-200";
            if (type === 'must-eat') colorClass = "tag-base tag-food";
            if (type === 'must-buy') colorClass = "tag-base tag-buy";
            if (type === 'transport') colorClass = "tag-base tag-transport";
            if (type === 'highlight') colorClass = "tag-base tag-highlight";
            if (type === 'code') colorClass = "tag-base tag-code";
            if (type === 'cost') colorClass = "tag-base tag-cost";
            return <span className={colorClass}>{text}</span>;
        };

        const EditModal = ({ event, onClose, onSave }) => {
            const [bookingCode, setBookingCode] = useState(event.bookingCode || '');
            const [cost, setCost] = useState(event.cost || '');
            const [note, setNote] = useState(event.note || '');

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm">
                    <div className="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl border-4 border-pink-200 animate-[bounce_0.2s_ease-out]">
                        <h3 className="text-xl font-bold text-pink-500 mb-4 flex items-center gap-2">
                            <i className="fa-solid fa-pen-to-square"></i> Á∑®ËºØË≥áË®ä
                        </h3>
                        <div className="space-y-4">
                            <div>
                                <label className="block text-xs font-bold text-slate-400 mb-1 ml-1">Ë®Ç‰Ωç‰ª£Á¢º / Á•®Ëôü</label>
                                <input 
                                    type="text" 
                                    value={bookingCode}
                                    onChange={(e) => setBookingCode(e.target.value)}
                                    placeholder="‰æãÂ¶Ç: XYZ123"
                                    className="w-full bg-slate-50 border-2 border-slate-200 rounded-xl px-3 py-2 focus:outline-none focus:border-pink-400 transition-colors"
                                />
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-400 mb-1 ml-1">Ë≤ªÁî® (ËªäË≥á/ÈñÄÁ•®)</label>
                                <div className="relative">
                                    <span className="absolute left-3 top-2 text-slate-400">¬•</span>
                                    <input 
                                        type="number" 
                                        value={cost}
                                        onChange={(e) => setCost(e.target.value)}
                                        placeholder="0"
                                        className="w-full bg-slate-50 border-2 border-slate-200 rounded-xl pl-7 pr-3 py-2 focus:outline-none focus:border-pink-400 transition-colors"
                                    />
                                </div>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-400 mb-1 ml-1">ÂÇôË®ªÁ≠ÜË®ò</label>
                                <textarea 
                                    value={note}
                                    onChange={(e) => setNote(e.target.value)}
                                    placeholder="ÂØ´Èªû‰ªÄÈ∫º..."
                                    rows="3"
                                    className="w-full bg-slate-50 border-2 border-slate-200 rounded-xl px-3 py-2 focus:outline-none focus:border-pink-400 transition-colors resize-none"
                                ></textarea>
                            </div>
                        </div>
                        <div className="flex gap-3 mt-6">
                            <button onClick={onClose} className="flex-1 py-2.5 rounded-xl font-bold text-slate-500 bg-slate-100 hover:bg-slate-200 transition-colors">ÂèñÊ∂à</button>
                            <button onClick={() => onSave({ bookingCode, cost, note })} className="flex-1 py-2.5 rounded-xl font-bold text-white bg-pink-400 hover:bg-pink-500 shadow-md shadow-pink-200 transition-colors">ÂÑ≤Â≠ò</button>
                        </div>
                    </div>
                </div>
            );
        };

        const TimelineItem = ({ event, isLast, onEdit }) => {
            let icon = 'fa-circle';
            let iconColor = 'text-slate-400';
            let iconBg = 'bg-slate-100';

            switch(event.type) {
                case 'transport': icon = 'fa-train-subway'; iconColor = 'text-blue-500'; iconBg = 'bg-blue-100'; break;
                case 'food': icon = 'fa-utensils'; iconColor = 'text-orange-500'; iconBg = 'bg-orange-100'; break;
                case 'sight': icon = 'fa-camera'; iconColor = 'text-teal-600'; iconBg = 'bg-teal-100'; break;
                case 'accommodation': icon = 'fa-bed'; iconColor = 'text-purple-500'; iconBg = 'bg-purple-100'; break;
                case 'activity': icon = 'fa-star'; iconColor = 'text-yellow-500'; iconBg = 'bg-yellow-100'; break;
            }

            return (
                <div className="relative pl-4 pb-8 last:pb-2 group">
                    {!isLast && <div className="absolute left-[27px] top-8 bottom-0 w-0.5 bg-slate-200 border-l-2 border-dotted border-slate-300 h-full"></div>}
                    <div className="flex gap-4">
                        <div className={`relative z-10 w-10 h-10 rounded-2xl flex items-center justify-center shrink-0 border-2 border-white shadow-md ${iconBg} ${iconColor}`}>
                            <i className={`fa-solid ${icon} text-sm`}></i>
                        </div>
                        <div className="flex-1 pt-0.5">
                            <div className="flex items-baseline justify-between mb-1">
                                <span className="font-bold text-slate-700 text-lg">{event.title}</span>
                                <span className="text-xs font-bold text-slate-400 bg-slate-100 px-2 py-1 rounded-lg">{event.time}</span>
                            </div>
                            <div className="mb-2">
                                {event.highlights && event.highlights.map((tag, idx) => (
                                    <Tag key={`hl-${idx}`} type={tag.type} text={tag.text} />
                                ))}
                                {event.bookingCode && <Tag type="code" text={`‰ª£Á¢º: ${event.bookingCode}`} />}
                                {event.cost && <Tag type="cost" text={`¬•${event.cost}`} />}
                            </div>
                            <p className="text-sm text-slate-500 leading-relaxed mb-2">{event.desc}</p>
                            {event.note && (
                                <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-2 text-xs text-yellow-800 mb-2">
                                    <i className="fa-regular fa-note-sticky mr-1"></i> {event.note}
                                </div>
                            )}
                            <div className="flex items-center gap-2">
                                <NavigateButton location={event.location} />
                                <button onClick={() => onEdit(event)} className="mt-2 text-xs text-pink-400 font-bold px-3 py-1.5 rounded-2xl border border-pink-200 hover:bg-pink-50 transition-colors flex items-center gap-1">
                                    <i className="fa-solid fa-pen"></i> Á∑®ËºØ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const DayCard = ({ day, isExpanded, onToggle, onUpdateEvent }) => {
            const [editingEvent, setEditingEvent] = useState(null);
            const handleSave = (data) => {
                onUpdateEvent(day.id, editingEvent.id, data);
                setEditingEvent(null);
            };

            return (
                <div className="app-card mb-5">
                    <div onClick={onToggle} className="p-4 flex items-center justify-between cursor-pointer active:bg-pink-50/50">
                        <div>
                            <div className="text-xs font-bold text-pink-500 uppercase tracking-wider mb-0.5 flex items-center gap-1">
                                <i className="fa-regular fa-calendar-check"></i> {day.date}
                            </div>
                            <h2 className="text-xl font-black text-slate-700">{day.title}</h2>
                        </div>
                        <div className={`w-8 h-8 rounded-full bg-pink-100 text-pink-500 flex items-center justify-center transition-transform duration-300 ${isExpanded ? 'rotate-180' : ''}`}>
                            <i className="fa-solid fa-chevron-down"></i>
                        </div>
                    </div>
                    {isExpanded && (
                        <div>
                            <div className={`mx-4 px-4 py-3 rounded-xl flex items-center justify-between text-sm font-bold border-2 ${day.weather.alert ? 'bg-amber-50 text-amber-600 border-amber-100' : 'bg-sky-50 text-sky-600 border-sky-100'}`}>
                                <div className="flex items-center gap-2">
                                    <i className={`fa-solid ${day.weather.icon} text-lg`}></i>
                                    <span>{day.weather.text}</span>
                                </div>
                                {day.weather.alert && <span className="text-[10px] bg-amber-200 text-amber-800 px-2 py-1 rounded-full animate-bounce">Ê≥®ÊÑè</span>}
                            </div>
                            <div className="p-4">
                                {day.events.map((event, index) => (
                                    <TimelineItem key={event.id} event={event} isLast={index === day.events.length - 1} onEdit={setEditingEvent} />
                                ))}
                            </div>
                        </div>
                    )}
                    {editingEvent && <EditModal event={editingEvent} onClose={() => setEditingEvent(null)} onSave={handleSave} />}
                </div>
            );
        };

        const ToolsView = ({ daysData, budgetData, onUpdateBudget }) => {
            // Ë®àÁÆóÂæûË°åÁ®ã‰∏≠Ëº∏ÂÖ•ÁöÑÁ∏ΩË≤ªÁî®
            const itineraryCost = daysData.reduce((total, day) => {
                return total + day.events.reduce((dayTotal, event) => {
                    return dayTotal + (parseInt(event.cost) || 0);
                }, 0);
            }, 0);

            const totalSpent = (budgetData?.manualSpent || 0) + itineraryCost;
            const remaining = (budgetData?.total || 0) - totalSpent;
            const percent = Math.min(100, (totalSpent / (budgetData?.total || 1)) * 100);

            const updateManualSpent = (amount) => {
                if (onUpdateBudget) {
                    onUpdateBudget({ ...budgetData, manualSpent: (budgetData?.manualSpent || 0) + amount });
                }
            };

            const resetBudget = () => {
                if (onUpdateBudget) {
                    onUpdateBudget({ ...budgetData, manualSpent: 0 });
                }
            };

            return (
                <div className="space-y-6 pb-24 p-4">
                    <a href="https://www.vjw.digital.go.jp/" target="_blank" rel="noopener noreferrer" 
                       className="block bg-gradient-to-r from-pink-400 to-rose-400 rounded-3xl p-1 shadow-lg transform active:scale-95 transition-transform">
                        <div className="bg-white/10 rounded-[1.3rem] p-4 flex items-center justify-between text-white">
                            <div>
                                <div className="text-xs font-bold opacity-90 mb-1">ÂÖ•Â¢ÉÂøÖÂÇô</div>
                                <div className="text-xl font-black">Visit Japan Web</div>
                            </div>
                            <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                                <i className="fa-solid fa-qrcode text-xl"></i>
                            </div>
                        </div>
                    </a>

                    <div className="app-card p-6 border-pink-100">
                         <div className="flex justify-between items-center mb-4">
                             <h3 className="text-lg font-black text-slate-700 flex items-center gap-2">
                                <i className="fa-solid fa-coins text-yellow-400"></i> È†êÁÆóÈå¢ÂåÖ
                             </h3>
                             <button onClick={resetBudget} className="text-xs text-slate-400 hover:text-pink-500 font-bold bg-slate-100 px-2 py-1 rounded-lg">ÈáçÁΩÆÊâãÂãï</button>
                         </div>
                        
                        <div className="mb-6 bg-slate-50 p-4 rounded-2xl border border-slate-100">
                            <div className="flex justify-between text-sm mb-2">
                                <span className="text-slate-500 font-bold">Â∑≤ÊîØÂá∫ (Ë°åÁ®ã+ÊâãÂãï)</span>
                                <span className="font-black text-slate-700 text-lg">¬•{totalSpent.toLocaleString()}</span>
                            </div>
                            <div className="w-full bg-slate-200 rounded-full h-4 overflow-hidden shadow-inner">
                                <div className="bg-gradient-to-r from-yellow-300 to-orange-400 h-4 rounded-full transition-all duration-500 shadow-[0_2px_5px_rgba(251,146,60,0.5)]" style={{width: `${percent}%`}}></div>
                            </div>
                            <div className="text-right mt-1">
                                <span className="text-xs text-slate-400 font-bold">Ââ©È§ò ¬•{remaining.toLocaleString()}</span>
                            </div>
                        </div>

                        <div className="grid grid-cols-3 gap-3">
                            <button onClick={() => updateManualSpent(1000)} className="btn-cute py-3 bg-white text-slate-600 border-2 border-slate-100 hover:border-pink-200 hover:text-pink-500">+¬•1,000</button>
                            <button onClick={() => updateManualSpent(5000)} className="btn-cute py-3 bg-white text-slate-600 border-2 border-slate-100 hover:border-pink-200 hover:text-pink-500">+¬•5,000</button>
                            <button onClick={() => updateManualSpent(10000)} className="btn-cute py-3 bg-white text-slate-600 border-2 border-slate-100 hover:border-pink-200 hover:text-pink-500">+¬•10,000</button>
                        </div>
                        <div className="mt-3 text-[10px] text-center text-slate-400">*Á∑®ËºØË°åÁ®ã‰∏≠ÁöÑË≤ªÁî®ÊúÉËá™ÂãïÂä†Á∏ΩÂñîÔºÅ</div>
                    </div>

                    <div className="app-card p-6 border-blue-100">
                        <h3 className="text-lg font-black text-slate-700 mb-4 flex items-center gap-2">
                            <i className="fa-solid fa-phone-volume text-blue-400"></i> Á∑äÊÄ•ËÅØÁµ°
                        </h3>
                        <div className="space-y-3">
                            <div className="flex justify-between items-center py-2 border-b border-dashed border-slate-200">
                                <span className="text-slate-500 text-sm font-bold">Â†±Ë≠¶ / ÊïëË≠∑Ëªä</span>
                                <span className="font-mono font-black text-slate-700 text-lg">110 / 119</span>
                            </div>
                            <div className="flex justify-between items-center py-2 border-b border-dashed border-slate-200">
                                <span className="text-slate-500 text-sm font-bold">ÈßêÊó•‰ª£Ë°®Ëôï</span>
                                <span className="font-mono font-bold text-slate-700 select-all">+81-3-3280-7811</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('itinerary');
            const [days, setDays] = useState(null); 
            const [budget, setBudget] = useState({ total: 200000, manualSpent: 0 });
            const [expandedDay, setExpandedDay] = useState('day1');
            const [isLoading, setIsLoading] = useState(true);
            const [isLocalMode, setIsLocalMode] = useState(false);

            // ÂàùÂßãÂåñËàáË™çË≠âÈÇèËºØ
            useEffect(() => {
                const initAuth = async () => {
                    // 1. Ê™¢Êü•ÊòØÂê¶ÁÇ∫Êú¨Âú∞ÈñãÁôº/Êú™Â°´ÂØ´ Key ÁöÑÁãÄÊÖã
                    if (firebaseConfig.apiKey === "‰Ω†ÁöÑ_API_KEY") {
                        console.warn("ÂÅµÊ∏¨Âà∞Êú™Ë®≠ÂÆö Firebase KeyÔºåÂàáÊèõÁÇ∫Êú¨Âú∞Ê®°Âºè (Local Storage)„ÄÇ");
                        setIsLocalMode(true);
                        
                        // Êú¨Âú∞Ê®°ÂºèÔºöÁõ¥Êé•ËÆÄÂèñ LocalStorage
                        const savedData = localStorage.getItem('trip_data_local');
                        if (savedData) {
                            const data = JSON.parse(savedData);
                            setDays(data.days);
                            setBudget(data.budget);
                        } else {
                            setDays(defaultItinerary);
                        }
                        setIsLoading(false);
                        return;
                    }

                    // 2. ÂòóË©¶ Firebase ÁôªÂÖ•
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                        console.error("Firebase Auth ÈåØË™§:", error);
                        // ÁôªÂÖ•Â§±Êïó‰πüÂàáÂõûÊú¨Âú∞Ê®°ÂºèÔºåÈÅøÂÖçÁï´Èù¢Âç°‰Ωè
                        setIsLocalMode(true);
                        setDays(defaultItinerary);
                        setIsLoading(false);
                    }
                };

                initAuth();

                // 3. Áõ£ËÅΩÁôªÂÖ•ÁãÄÊÖã (ÂÉÖÂú®ÈùûÊú¨Âú∞Ê®°Âºè‰∏ã)
                const unsubscribeAuth = onAuthStateChanged(auth, async (user) => {
                    if (user && firebaseConfig.apiKey !== "‰Ω†ÁöÑ_API_KEY") {
                        // ‰ΩøÁî®Ê≠£Á¢∫ÁöÑ Public Data Ë∑ØÂæë: artifacts/appId/public/data/trips/shared_japan_2025
                        const docRef = doc(db, ...TRIP_DOC_PATH);
                        
                        try {
                            const docSnap = await getDoc(docRef);
                            if (!docSnap.exists()) {
                                await setDoc(docRef, {
                                    days: defaultItinerary,
                                    budget: { total: 200000, manualSpent: 0 }
                                });
                            }

                            const unsubscribeSnapshot = onSnapshot(docRef, (doc) => {
                                if (doc.exists()) {
                                    const data = doc.data();
                                    setDays(data.days);
                                    if (data.budget) setBudget(data.budget);
                                }
                                setIsLoading(false);
                            });
                            return () => unsubscribeSnapshot();
                        } catch (e) {
                            console.error("Firestore ËÆÄÂèñÈåØË™§:", e);
                            setIsLocalMode(true);
                            setDays(defaultItinerary);
                            setIsLoading(false);
                        }
                    }
                });

                return () => unsubscribeAuth();
            }, []);

            // Êõ¥Êñ∞‰∫ã‰ª∂
            const handleUpdateEvent = async (dayId, eventId, newData) => {
                if (!days) return;
                
                const updatedDays = days.map(day => {
                    if (day.id !== dayId) return day;
                    return {
                        ...day,
                        events: day.events.map(ev => {
                            if (ev.id !== eventId) return ev;
                            return { ...ev, ...newData };
                        })
                    };
                });
                
                setDays(updatedDays);

                if (isLocalMode) {
                    localStorage.setItem('trip_data_local', JSON.stringify({ days: updatedDays, budget }));
                } else {
                    try {
                        const docRef = doc(db, ...TRIP_DOC_PATH);
                        await updateDoc(docRef, { days: updatedDays });
                    } catch (e) {
                        console.error("Êõ¥Êñ∞Â§±Êïó:", e);
                    }
                }
            };

            // Êõ¥Êñ∞È†êÁÆó
            const handleUpdateBudget = async (newBudget) => {
                setBudget(newBudget);
                
                if (isLocalMode) {
                    localStorage.setItem('trip_data_local', JSON.stringify({ days, budget: newBudget }));
                } else {
                    try {
                        const docRef = doc(db, ...TRIP_DOC_PATH);
                        await updateDoc(docRef, { budget: newBudget });
                    } catch (e) {
                        console.error("È†êÁÆóÊõ¥Êñ∞Â§±Êïó:", e);
                    }
                }
            };

            useEffect(() => {
                window.scrollTo(0, 0);
            }, [activeTab]);

            if (isLoading) {
                return (
                    <div className="min-h-screen bg-[#fff1f2] flex flex-col items-center justify-center text-pink-400 gap-4">
                        <i className="fa-solid fa-cloud text-6xl chiikawa-bounce"></i>
                        <p className="font-bold text-lg">ËºâÂÖ•‰∏≠...</p>
                    </div>
                );
            }

            return (
                <div className="max-w-md mx-auto min-h-screen bg-[#fff1f2] overflow-x-hidden">
                    <header className="sticky top-0 z-40 bg-[#fff1f2]/90 backdrop-blur-md px-5 py-4 border-b-2 border-pink-100 flex justify-between items-center shadow-sm">
                        <h1 className="text-2xl font-black text-slate-700 tracking-tight flex items-center gap-2">
                            <span className="text-pink-500 text-3xl">‚úàÔ∏è</span>
                            <span>Japan<span className="text-pink-400">Trip</span></span>
                        </h1>
                        <div className="w-10 h-10 rounded-full bg-white border-2 border-pink-200 flex items-center justify-center shadow-sm">
                            <i className="fa-solid fa-face-smile text-pink-400 text-xl"></i>
                        </div>
                    </header>

                    {isLocalMode && (
                        <div className="bg-orange-100 text-orange-700 text-xs font-bold text-center py-2 px-4">
                            <i className="fa-solid fa-triangle-exclamation mr-1"></i>
                            ÁõÆÂâçÁÇ∫È†êË¶Ω/Èõ¢Á∑öÊ®°Âºè (Ë≥áÊñôÂÉÖÂ≠òÊñºÊ≠§Ë£ùÁΩÆ)
                        </div>
                    )}

                    <main className="pt-6">
                        {activeTab === 'itinerary' ? (
                            <div className="px-4">
                                {days && days.map(day => (
                                    <DayCard 
                                        key={day.id} 
                                        day={day} 
                                        isExpanded={expandedDay === day.id}
                                        onToggle={() => setExpandedDay(expandedDay === day.id ? null : day.id)}
                                        onUpdateEvent={handleUpdateEvent}
                                    />
                                ))}
                                <div className="text-center text-pink-300 font-bold text-sm mt-8 mb-4">
                                    ~ ÊóÖÈÄîÊÑâÂø´ ~
                                </div>
                            </div>
                        ) : (
                            <ToolsView daysData={days || []} budgetData={budget} onUpdateBudget={handleUpdateBudget} />
                        )}
                    </main>

                    <nav className="fixed bottom-6 left-6 right-6 bg-white/95 backdrop-blur rounded-[2rem] shadow-[0_8px_30px_rgba(0,0,0,0.12)] border border-white z-50 max-w-[calc(28rem-3rem)] mx-auto">
                        <div className="flex justify-around items-center h-16">
                            <button 
                                onClick={() => setActiveTab('itinerary')}
                                className={`flex items-center gap-2 px-6 py-2 rounded-full transition-all duration-300 ${activeTab === 'itinerary' ? 'bg-pink-100 text-pink-500 font-bold' : 'text-slate-400 font-medium'}`}
                            >
                                <i className="fa-solid fa-map-location-dot text-lg"></i>
                                {activeTab === 'itinerary' && <span>Ë°åÁ®ã</span>}
                            </button>
                            <div className="w-px h-8 bg-slate-100"></div>
                            <button 
                                onClick={() => setActiveTab('tools')}
                                className={`flex items-center gap-2 px-6 py-2 rounded-full transition-all duration-300 ${activeTab === 'tools' ? 'bg-pink-100 text-pink-500 font-bold' : 'text-slate-400 font-medium'}`}
                            >
                                <i className="fa-solid fa-suitcase text-lg"></i>
                                {activeTab === 'tools' && <span>Â∑•ÂÖ∑</span>}
                            </button>
                        </div>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>